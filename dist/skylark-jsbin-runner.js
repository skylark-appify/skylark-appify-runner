/**
 * skylark-jsbin-runner - A version of jsbin-runner  that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-jsbin-runner/
 * @license MIT
 */
!function(e,n){var r=n.define,require=n.require,o="function"==typeof r&&r.amd,t=!o&&"undefined"!=typeof exports;if(!o&&!r){var s={};r=n.define=function(e,n,r){"function"==typeof r?(s[e]={factory:r,deps:n.map(function(n){return function(e,n){if("."!==e[0])return e;var r=n.split("/"),o=e.split("/");r.pop();for(var t=0;t<o.length;t++)"."!=o[t]&&(".."==o[t]?r.pop():r.push(o[t]));return r.join("/")}(n,e)}),resolved:!1,exports:null},require(e)):s[e]={factory:null,resolved:!0,exports:r}},require=n.require=function(e){if(!s.hasOwnProperty(e))throw new Error("Module "+e+" has not been defined");var module=s[e];if(!module.resolved){var r=[];module.deps.forEach(function(e){r.push(require(e))}),module.exports=module.factory.apply(n,r)||null,module.resolved=!0}return module.exports}}if(!r)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(function(e,require){e("skylark-jsbin-runner/runner",["skylark-langx-ns","skylark-loopprotect"],function(e,n){"use strict";var r={};return n.hit=function(e){console.warn("Exiting potential infinite loop at line "+e+'. To disable loop protection: add "// noprotect" to your code'),r.postMessage("loopProtectHit",e)},r.parent={},r.parent.origin="*",r.error=function(){var e=["Runner:"].concat([].slice.call(arguments));if(!("console"in window))return alert(e.join(" "))},r.handleMessage=function(e){if(e.origin){var n=e.data;try{n="string"==typeof e.data?JSON.parse(e.data):e.data}catch(e){return r.error("Error parsing event data:",e.message)}if(r.commands&&"function"!=typeof r.commands[n.type])return r.error("No matching event handler:",n.type);r.parent.source=e.source;try{r.commands[n.type](n.data)}catch(e){r.error(e.message)}}},r.postMessage=function(e,n){if(!r.parent.source)return r.error("No postMessage connection to parent window.");r.parent.source.postMessage(JSON.stringify({type:e,data:n}),r.parent.origin)},e.attach("appify.runner",r)}),e("skylark-jsbin-runner/proxy-console",["./runner"],function(e){"use strict";var n=function(){try{window.console.log("d[ o_0 ]b")}catch(e){!1}var n=function(){},r=n.prototype.methods=["debug","clear","error","info","log","warn","dir","props","_raw","group","groupEnd","dirxml","table","trace","assert","count","markTimeline","profile","profileEnd","time","timeEnd","timeStamp","groupCollapsed"];return r.forEach(function(r){n.prototype[r]=function(){var n=[].slice.call(arguments),o=function(e){for(var n,r=[],o=0,t=e.length;o<t;o++)void 0===(n=e[o])?r.push("undefined"):r.push(JSON.stringify(n));return r}(n);e.postMessage("console",{method:"_raw"===r?n.shift():r,args:"_raw"===r?o.slice(1):o}),window.console&&(console[r]||(r="log"),window.console&&"_raw"!==r&&("clear"!==r||"clear"===r&&console.clear)&&console[r].apply(console,n))}}),new n}();return e.proxyConsole=n}),e("skylark-jsbin-runner/processor",["skylark-loopprotect","./runner"],function(e,n){"use strict";var r,o={};o.blockingMethods={kill:'<script>(function(){window.__blocked={methods:["open","print","alert","prompt","confirm"],old:{}};for(var m in __blocked.methods){try {__blocked.old[m]=window[m];window[m]=function(){};}catch(e){}}})()<\/script>',restore:"\x3c!--jsbin live harness--\x3e<script>(function(){for(var m in __blocked.methods){try{window[m]=__blocked.old[m];delete __blocked;}catch(e){}};})()<\/script>"},o.getDoctype=(r=/<!doctype [\s\S]*?>/i,function(e){var n=(e.match(r)||[""])[0],o=e.substr(n.length);return{doctype:n,tail:o}}),o.debug=function(e){return"<pre>"+e.replace(/[<>&]/g,function(e){return"<"==e?"&lt;":">"==e?"&gt;":"&"==e?"&amp;":void 0})+"</pre>"},o.render=function(e,n){n=n||{},e=e||"";var r=[],t=!0!==n.requested,s=!1===n.includeJsInRealtime;t&&s&&(e=e.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"")),e=e.replace(/(<.*?\s)(autofocus)/g,"$1");var i=o.getDoctype(e),c=i.doctype;return e=i.tail,r.push(c),t&&n.includeJsInRealtime&&r.push(o.blockingMethods.kill),r.push(e),t&&n.includeJsInRealtime&&r.push(o.blockingMethods.restore),n.debug?o.debug(r.join("\n")):r.join("\n")};var t={"<":"&lt;",">":"&gt;","&":"&amp;"},s={docReady:/\$\(document\)\.ready/,shortDocReady:/\$\(function/,console:/(^.|\b)console\.(\S+)/g,script:/<\/script/gi,code:/%code%/,csscode:/%css%/,description:/(<meta name="description" content=")([^"]*)/im,title:/<title>(.*)<\/title>/im,winLoad:/window\.onload\s*=/,scriptopen:/<script/gi};return o.prepare=function(n){s.docReady.lastIndex=0,s.shortDocReady.lastIndex=0,s.console.lastIndex=0,s.script.lastIndex=0,s.code.lastIndex=0,s.csscode.lastIndex=0,s.title.lastIndex=0,s.winLoad.lastIndex=0,s.scriptopen.lastIndex=0;var r=[],o=n.html,i=n.javascript||"",c=n.css,a="",l=!!o.trim().length,d=!!c.trim().length,u=!!i.trim().length;if(l&&(i="try {"+i+"\n} catch (error) { throw error; }"),e.alias="window.runnerWindow.protect",i=(i=e(i)).replace(s.script,"<\\/script"),s.console.test(i)&&(i=i.replace(s.console,function(e,n,r){return"window.runnerWindow.proxyConsole."+r})),!l&&u)o="<pre>\n"+i.replace(/[<>&]/g,function(e){return t[e]})+"</pre>";else if(s.code.test(o))o=o.split("%code%").join(code.javascript);else if(u){a="",-1!==o.indexOf("</body>")&&(r.push(o.substring(0,o.lastIndexOf("</body>"))),r.push(o.substring(o.lastIndexOf("</body>"))),o=r[0],a=2===r.length&&r[1]?r[1]:"");o+="<scripttext/script>"+i+"\n<\/script>\n"+a}if(s.console.test(o)){o=o.replace(s.console,function(e,n,r,t){var s=o.lastIndexOf("<script",t),i=o.lastIndexOf("</script",t);return null,s>i?"window.runnerWindow.proxyConsole."+r:e})}return l||u||!d?s.csscode.test(o)?o=o.split("%css%").join(c):l&&(r=[],a="",-1!==o.indexOf("</head>")&&(r.push(o.substring(0,o.indexOf("</head>"))),r.push(o.substring(o.indexOf("</head>"))),o=r[0],a=2===r.length&&r[1]?r[1]:""),o+='<style id="jsbin-css">\n'+c+"\n</style>\n"+a):o="<pre>\n"+c.replace(/[<>&]/g,function(e){return t[e]})+"</pre>",o},n.processor=o}),e("skylark-jsbin-runner/sandbox",["skylark-loopprotect","skylark-domx-plugins-sandboxs/sandbox","./runner","./proxy-console","./processor"],function(e,n,r,o,t){"use strict";var s;return r.sandbox={init:function(e){s=new n(e,{cssTextTagId:"jsbin-css"})},render:function(n){e.reset(),!n.source&&n.codes&&(n.source=t.prepare(n.codes));var i=t.render(n.source,n.options);n.options.proxyConsole=o,n.options.loopProtect=e,s.render(i,n.options),r.postMessage("complete")},injectScript:function(e,n){return s.injectScript(e,n)},injectDOM:function(e,n){return s.injectDOM(e,n)},injectCssText:function(e){return s.injectCssText(e)},eval:function(e){return s.eval(e)},isActive:function(){return!!s.active}}}),e("skylark-jsbin-runner/commands",["./runner","./sandbox"],function(e,n){"use strict";var r={render:function(e){if(e.options.injectCSS&&n.isActive()){let r=e.source||e.codes&&e.codes.css;return n.injectCssText(r)}return n.render(e)},"console:run":function(e){n.eval(e)},"console:load:script":function(r){n.injectScript(r,function(n){if(n)return e.postMessage("console:load:script:error",n);e.postMessage("console:load:script:success",r)})},"console:load:dom":function(r){n.injectDOM(r,function(n){if(n)return e.postMessage("console:load:dom:error",n);e.postMessage("console:load:dom:success")})}};return e.commands=r}),e("skylark-jsbin-runner/init",["skylark-domx-eventer","./runner","./sandbox"],function(e,n,r){"use strict";return n.init=function(){window.onload=function(){if(!window.postMessage){var o=document.createElement("iframe");return o.setAttribute("sandbox","allow-modals allow-forms allow-pointer-lock allow-popups allow-same-origin allow-scripts"),o.setAttribute("frameBorder","0"),document.body.appendChild(o),void(o.src=window.name)}r.init(document.getElementById("sandbox-wrapper")),e.on(window,"message",n.handleMessage)}}}),e("skylark-jsbin-runner/main",["./runner","./commands","./processor","./proxy-console","./runner","./sandbox","./init"],function(e){return e}),e("skylark-jsbin-runner",["skylark-jsbin-runner/main"],function(e){return e})}(r),!o){var i=require("skylark-langx-ns");t?module.exports=i:n.skylarkjs=i}}(0,this);
//# sourceMappingURL=sourcemaps/skylark-jsbin-runner.js.map
